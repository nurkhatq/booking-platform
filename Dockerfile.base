FROM golang:1.21-alpine AS base

WORKDIR /app

# Install build dependencies
RUN apk add --no-cache git ca-certificates tzdata

# Copy go modules first for better caching
COPY go.mod go.sum ./
RUN go mod download

# Copy shared code
COPY shared/ ./shared/

# Build shared dependencies to cache them
RUN go build -o /dev/null ./shared/...
